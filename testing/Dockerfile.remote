# This sets up an environment to test the remote dotfiles installer as you
# would on a fresh Arch installation:
#
# 1. Build a docker container and run it:
#
#   On Linux:
#     docker build -f testing/Dockerfile.remote -t test-dotfiles-remote .
#
#   On macos:
#     docker build --platform linux/amd64 \
#       -f testing/Dockerfile.remote -t test-dotfiles-remote .
#
#   docker run -it --rm test-dotfiles-remote
#
# 2. Init the remote installation as per README.md instructions:
#
#   curl -fsSL https://raw.githubusercontent.com/davelens/dotfiles/refs/heads/master/setup/remote/init.sh | bash
#
FROM archlinux:base

# Install minimal dependencies needed for my dotfiles.
RUN pacman -Syu --noconfirm git python sudo openssh

# Create a non-root test user with passwordless sudo
RUN useradd -m -s /bin/bash testuser && \
    echo "testuser ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers
USER testuser
WORKDIR /home/testuser

# Remove default bash files so dotbot can link ours
RUN rm -f ~/.bash_profile ~/.bashrc

CMD ["/bin/bash", "--login"]
