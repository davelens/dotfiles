#!/usr/bin/env bash

# Stops further execution after any error.
set -e
BASENAME=`basename $0`

# Ensure we have at least two arguments
if [ $# -lt 2 ]; then
  echo "Usage: $BASENAME <category> <command> [<args>...]"
  exit 1
fi

# Define the base directory for scripts
BASE_DIR="${HOME}/.dotfiles/bin/$BASENAME-scripts"
CATEGORY="$1"
COMMAND="$2"

# Extract the full dave command prompt for use in subscripts
export DAVE_FULL_COMMAND="$BASENAME $@"
export DAVE_BASE_COMMAND="$BASENAME $CATEGORY $COMMAND"

# Shift off category and command, leaving any remaining arguments
shift 2

# Extract the category and command arguments for use in subscripts
export DAVE_SUBSCRIPT="$CATEGORY/$COMMAND"

# Construct the path to the script
SCRIPT_PATH="$BASE_DIR/$CATEGORY/$COMMAND"

# Check if the script exists and is executable
if [ -x "$SCRIPT_PATH" ]; then
  "$SCRIPT_PATH" "$@"  # Execute the script with remaining arguments
else
  echo "Error: Script '$COMMAND' not found in '$BASE_DIR/$CATEGORY' or not executable."
  exit 1
fi
