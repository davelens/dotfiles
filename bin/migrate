#!/bin/bash
set -e

if [ -x config/cable.yml ]; then # Rails 5+
  command=rails
else # Rails < 5
  command=rake
fi

if [[ $# -eq 1 && $1 == '-r' ]]; then
  action=rollback
else
  action=migrate
fi

[ -x bin/ ] && command=bin/$command

[ -x spec/dummy ] && pushd spec/dummy >/dev/null # Rails engine support
$command db:$action
$command db:$action RAILS_ENV=test
[ -x spec/dummy ] && popd >/dev/null
