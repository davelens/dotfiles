#!/bin/bash
set -e

if [ -f config/cable.yml ]; then # Rails 5+
  command='bundle exec rails'
else # Rails < 5
  command='bundle exec rake'
fi

if [[ $# -eq 1 && $1 == '-r' ]]; then
  action=rollback
else
  action=migrate
fi

[ -x bin/bundle ] && command=bin/$command

#if [ -x spec/dummy ]; then
  #pushd spec/dummy >/dev/null # Rails engine support
  #popd >/dev/null
#else
#fi

$command db:$action
$command db:$action RAILS_ENV=test
