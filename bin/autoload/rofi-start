#!/usr/bin/env bash

# Stops further execution after any error.
set -e

XDG_CONFIG_HOME="${XDG_CONFIG_HOME:-$HOME/.config}"

launcher="type-1"
# Available styles are 1 to 15.
theme="style-5"
mode="drun"
dmenu=0
powermenu=0

main() {
  # Toggle behavior: if rofi is already running, kill it and exit
  if pgrep -x rofi >/dev/null; then
    pkill -x rofi
    exit 0
  fi

  while [[ $# -gt 0 ]]; do
    case $1 in
    --powermenu)
      powermenu=1
      shift
      ;;
    --dmenu)
      dmenu=1
      shift
      ;;
    --launcher)
      launcher="${2:-$launcher}"
      shift 2
      ;;
    --theme)
      theme="${2:-$theme}"
      shift 2
      ;;
    --mode)
      mode="${2:-$mode}"
      shift 2
      ;;
    *)
      # unknown options
      echo "ERROR: Unknown option '$1'"
      echo "Usage: rofi-start [--type] [--theme] [--mode] [--title]"
      exit
      ;;
    esac
  done

  if [ $powermenu -eq 1 ]; then
    "$XDG_CONFIG_HOME/rofi/powermenu/type-1/powermenu.sh"
  else
    if [ $dmenu -eq 1 ]; then
      cmd="rofi -dmenu show"
    else
      cmd="rofi -show $mode"
    fi

    # shellcheck disable=SC2086
    $cmd -theme $XDG_CONFIG_HOME/rofi/launchers/$launcher/${theme}.rasi
  fi
}

main "$@"
